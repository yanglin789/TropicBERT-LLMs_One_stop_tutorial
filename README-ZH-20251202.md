# TropicBERTï¼šçƒ­å¸¦æ°´æœä½œç‰©çš„åŸºå› ç»„åŸºç¡€æ¨¡å‹

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org)
[![Hugging Face](https://img.shields.io/badge/ğŸ¤—%20Hugging%20Face-TropicBERT-blue)](https://huggingface.co/yang0104/TropicBERT)
[![GitHub Repo](https://img.shields.io/badge/GitHub-Tutorial-green)](https://github.com/yanglin789/TropicBERT-LLMs_One_stop_tutorial)


---
## ğŸ“– é¡¹ç›®ç®€ä»‹

**TropicBERT-LLMs_One_stop_tutorial** æ˜¯ä¸€ä¸ªå°†è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰çš„â€œé¢„è®­ç»ƒ-å¾®è°ƒâ€èŒƒå¼è¿ç§»åˆ°åŸºå› ç»„å­¦é¢†åŸŸçš„å®Œæ•´å¼€æºæµç¨‹ã€‚

åŸºäºè¯¥æ¨¡å‹è®­ç»ƒæµç¨‹ï¼Œæˆ‘ä»¬è®­ç»ƒäº†**TropicBERT** ç³»åˆ—æ¨¡å‹ã€‚**TropicBERT** æ˜¯é¦–ä¸ªä¸“ä¸º **10 ç§çƒ­å¸¦æ°´æœç‰©ç§** è®¾è®¡çš„åŸºå› ç»„åŸºç¡€æ¨¡å‹ï¼Œæ—¨åœ¨å°†è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­çš„ Transformer æŠ€æœ¯è¿ç§»åˆ° DNA åºåˆ—åˆ†æä¸­

**ä¸»è¦åŠŸèƒ½ï¼š**
- ğŸ§¬ **åŸºå› ç»„é¢„è®­ç»ƒ**ï¼šåŸºäºæ©ç è¯­è¨€å»ºæ¨¡ï¼ˆMLMï¼‰å­¦ä¹ åŸºå› ç»„åºåˆ—ç‰¹å¾ã€‚
- ğŸ¯ **ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒ**ï¼šæ”¯æŒå¯åŠ¨å­å¼ºåº¦é¢„æµ‹ã€æŸ“è‰²è´¨å¼€æ”¾æ€§é¢„æµ‹ç­‰å›å½’ä¸åˆ†ç±»ä»»åŠ¡ã€‚
- ğŸ“Š **å…¨æµç¨‹æ”¯æŒ**ï¼šæä¾›ä»åŸå§‹ FASTA å¤„ç†ã€æ¨¡å‹è®­ç»ƒåˆ°ç»“æœå¯è§†åŒ–çš„å®Œæ•´ä»£ç ã€‚

é€‚åˆä¸åŒèƒŒæ™¯çš„ç ”ç©¶äººå‘˜å¿«é€Ÿä¸Šæ‰‹ã€‚


---
## ğŸ¯ äº®ç‚¹

- **å®Œæ•´æ­å»ºæµç¨‹**ï¼šåŸå§‹ FASTA â†’ æ ‡å‡†åŒ– â†’ é¢„è®­ç»ƒ â†’ å¾®è°ƒ â†’ ç»“æœå¯è§†åŒ–
- **å®Œå…¨å¼€æº**ï¼šä»£ç ã€æ¨¡å‹æƒé‡ã€åˆ†è¯å™¨ï¼ˆTokenizerï¼‰åŠæ•™ç¨‹å…¨é“¾è·¯å…¬å¼€ã€‚
- **æ˜“äºå¤ç°**ï¼šæ ‡å‡†åŒ–çš„æ•°æ®å¤„ç†ä¸è®­ç»ƒè„šæœ¬ï¼Œé€‚åˆä¸åŒèƒŒæ™¯çš„ç ”ç©¶è€…ã€‚
- **çƒ­å¸¦æ°´æœé¢„è®­ç»ƒæ¨¡å‹**ï¼šé¦–ä¸ªé’ˆå¯¹çƒ­å¸¦æ°´æœä½œç‰©çš„åŸºå› ç»„é¢„è®­ç»ƒæ¨¡å‹ã€‚
- **å¤šå°ºåº¦æ¨¡å‹**ï¼šæä¾›åŸºäº 1 / 5 / 10 ç§ç‰©ç§çš„é¢„è®­ç»ƒæ¨¡å‹å˜ä½“ï¼Œå…·å¤‡å¼ºè·¨ç‰©ç§è¿ç§»èƒ½åŠ›ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```plaintext
TropicBERT-LLMs_One_stop_tutorial/
â”œâ”€â”€ 00-info/                            # ç¯å¢ƒé…ç½®ä¸æ•°æ®é¢„å¤„ç†
â”œâ”€â”€ 01-pretrain_all/                    # é¢„è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ 01-code-pretrain/               # é¢„è®­ç»ƒæ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ 02-model_pretrain_example/      # é¢„è®­ç»ƒæ¨¡å‹ç¤ºä¾‹
â”‚   â””â”€â”€ 03-data_pretrain_example/       # é¢„è®­ç»ƒæ•°æ®ç¤ºä¾‹
â”œâ”€â”€ 02-finetune_all/                    # å¾®è°ƒæ¨¡å—
â”‚   â”œâ”€â”€ 01-code-finetune/               # å¾®è°ƒæ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ 02-model_finetune_example/      # å¾®è°ƒæ¨¡å‹ç¤ºä¾‹
â”‚   â””â”€â”€ 03-data_finetune_example/       # å¾®è°ƒæ•°æ®ç¤ºä¾‹
â””â”€â”€ 03-Result-Processing_Plotting/      # ç»“æœå¤„ç†ä¸å¯è§†åŒ–
â””â”€â”€ 04-Data-processing/                 # (æ–°å¢) åŸå§‹æ•°æ®é¢„å¤„ç†æµç¨‹ä»£ç 
```

---

## âš™ï¸ ç¯å¢ƒè¦æ±‚

**æ¨èé…ç½®ï¼š**
- Python >= 3.11
- Conda >= 25.7.0
- NVIDIA GPU æ˜¾å­˜ â‰¥ 16GB
- CUDA 12.1ï¼ˆæˆ–ä¸ç›®æ ‡ PyTorch ç‰ˆæœ¬åŒ¹é…ï¼‰

**ä¸»è¦ä¾èµ–ï¼š**
```txt
- Conda 25.7.0
- Python 3.11.11
- PyTorch 2.8.0+cu128
- Transformers 4.57.0
```
å®Œæ•´ä¾èµ–è§ `environment.yml`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å®‰è£…ç¯å¢ƒ

```bash
# è¿›å…¥å­˜æ”¾ç¯å¢ƒä¿¡æ¯çš„ç›®å½•ä¸‹
cd 00-info/

# æ–¹å¼1ï¼šä½¿ç”¨condaåˆ›å»ºæ–°ç¯å¢ƒï¼ˆæ¨èï¼‰
conda env create -f environment.yml -n AI_env
conda activate AI_env

# æ–¹å¼2ï¼šä½¿ç”¨pipå®‰è£…ä¾èµ–
pip install -r requirements.txt

```
å®‰è£…ç¯å¢ƒä¾èµ–ï¼Œæä¾›ä¸¤ç§æ–¹å¼ï¼šä¸€ç§ä¸ºä½¿ç”¨condaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦ä¸€ç§ä¸ºä½¿ç”¨pipç›´æ¥å®‰è£…ä¾èµ–

---

### 2ï¸âƒ£ é¢„è®­ç»ƒï¼ˆåŸºå› ç»„åºåˆ—æ©ç ï¼‰

ä½¿ç”¨æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMLMï¼‰ä»»åŠ¡å¯¹åŸºå› ç»„åºåˆ—è¿›è¡Œè‡ªç›‘ç£å­¦ä¹ ã€‚

**å‡†å¤‡å·¥ä½œ**ï¼š
1. **æ¨¡å‹ä¸åˆ†è¯å™¨ä¸‹è½½**ï¼šä» [HuggingFace](https://huggingface.co/yang0104/TropicBERT) ä¸‹è½½æ¨¡å‹æ–‡ä»¶åŠåˆ†è¯å™¨ã€‚
2. **æ¨¡å‹ä¸åˆ†è¯å™¨é€‚é…**ï¼š
    - è‹¥ä¸‹è½½çš„æ˜¯ TropicBERTs æ¨¡å‹ï¼Œæ— éœ€å¯¹åˆ†è¯å™¨è¿›è¡Œä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨ä¸‹è½½çš„åˆ†è¯å™¨å³å¯ã€‚
    - è‹¥ä½¿ç”¨å…¶ä»– NLP æ¨¡å‹ï¼Œä»…ä½¿ç”¨å…¶æ¨¡å‹æ–‡ä»¶ï¼Œåˆ†è¯å™¨åˆ™ä½¿ç”¨ç¤ºä¾‹æ–‡ä»¶ä¸­æä¾›çš„åˆ†è¯å™¨æ–‡ä»¶ã€‚
3. **æ–‡ä»¶å­˜æ”¾**ï¼šå°†ä¸‹è½½çš„æ¨¡å‹æ–‡ä»¶ä¸åˆ†è¯å™¨ï¼ˆæˆ–ç¤ºä¾‹ä¸­çš„åˆ†è¯å™¨æ–‡ä»¶ï¼‰æ”¾ç½®äº `01-pretrain_all/02-model_pretrain_example/` ç›®å½•ä¸‹ã€‚è‹¥ä¸º TropicBERTs æ¨¡å‹ï¼Œä¹ŸæŒ‰æ­¤è·¯å¾„å­˜æ”¾ã€‚
4. **æ•°æ®å‡†å¤‡**ï¼šå¯ä½¿ç”¨ç¤ºä¾‹æ•°æ® `01-pretrain_all/03-data_pretrain_example/` ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹ä¸ºå®é™…ä½¿ç”¨çš„æ•°æ®é›†ã€‚


**è¿è¡Œç¤ºä¾‹ï¼š**
```bash
cd 01-pretrain_all/01-code-pretrain

# æ–¹å¼1ï¼šbashå‘½ä»¤è¡Œè¿è¡Œ
python 01-pretrain.py \
    --model_name_or_path ../02-model_pretrain_example/bert-6MER-retokenizer \
    --train_data ../03-data_pretrain_example/pretrain_data.txt \
    --output_dir output_pretrain

# æ–¹å¼2ï¼šbashæ–‡ä»¶è¿è¡Œ(æ¨èï¼Œä¾¿äºé¡¹ç›®ç®¡ç†)
bash 02-pretrain.sh
```


---
### 3ï¸âƒ£ å¾®è°ƒï¼ˆä¸‹æ¸¸ä»»åŠ¡ï¼‰
åœ¨ä¸‹æ¸¸ä»»åŠ¡ï¼ˆå¦‚å¯åŠ¨å­é¢„æµ‹ï¼‰ä¸Šå¾®è°ƒæ¨¡å‹ã€‚

**å‡†å¤‡å·¥ä½œï¼š**
1. å°†é¢„è®­ç»ƒå¥½çš„æ¨¡å‹æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰å¤åˆ¶åˆ°ï¼š
`02-finetune_all/02-model_finetune_example/`
2. ä½¿ç”¨ç¤ºä¾‹æ•°æ® `02-finetune_all/03-data_finetune_example/` æˆ–ä¿®æ”¹ä¸ºå®é™…ä½¿ç”¨çš„æ•°æ®é›†

**è¿è¡Œå¾®è°ƒï¼š**
```bash
cd 02-finetune_all/01-code-finetune

# æ–¹å¼1ï¼šbashå‘½ä»¤è¡Œè¿è¡Œ
python 01-finetune.py \
    --model_name_or_path ../02-model_finetune_example/pretrained_bert_6MER_ckpt40 \
    --train_task regression \
    --reinit_classifier_layer True \
    --train_data ../03-data_finetune_example/regression_train_data.csv \
    --eval_data ../03-data_finetune_example/regression_dev_data.csv \
    --test_data ../03-data_finetune_example/regression_test_data.csv \
    --output_dir output_finetune \
    --run_name runs_finetune \
    --model_max_length 512 \
    --gradient_accumulation_steps 4 \
    --per_device_train_batch_size 16 \
    --per_device_eval_batch_size 16 \
    --num_train_epochs 5 \
    --logging_steps 50 \
    --eval_steps 50 \
    --save_steps 1000 \
    --warmup_ratio 0.05 \
    --weight_decay 0.01 \
    --learning_rate 1e-5 \
    --save_total_limit 5

# æ–¹å¼2ï¼šbashæ–‡ä»¶è¿è¡Œ(æ¨èï¼Œä¾¿äºé¡¹ç›®ç®¡ç†)
bash 02-finetune.sh
```

---
### 4ï¸âƒ£ ç»“æœå¯è§†åŒ–
æä¾›æå–è®­ç»ƒè¿‡ç¨‹æ•°æ®+è¯„ä¼°ç»“æœ+ç»˜åˆ¶ç›¸å…³æ•°æ®å›¾è¡¨çš„ä»£ç ï¼š

```bash
cd 03-Result-Processing_Plotting

# æå–æŒ‡æ ‡å¹¶ç»˜å›¾ (éœ€æ ¹æ®å®é™…æ—¥å¿—è·¯å¾„ä¿®æ”¹ä»£ç )
python 01_sort_out_result_files.py
python 02_test_metrics_extract_csv.py
python 03_Extract_draw_trainer_state.py
```
ï¼ˆåœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦æ ¹æ®å®é™…çš„æ–‡ä»¶ç›®å½•å»ä¿®æ”¹ä»£ç ä¸­æ–‡ä»¶çš„è¾“å…¥ä¸è¾“å‡ºè·¯å¾„ï¼‰


**è¾“å‡ºç¤ºä¾‹ï¼š**
![è®­ç»ƒæŒ‡æ ‡ç¤ºä¾‹](trainer_state_train_metrics_epoch.png)

---

## ğŸ“Š æ•°æ®å¤„ç†ä¸æ ¼å¼


### é¢„è®­ç»ƒæ•°æ®ï¼ˆTXTï¼‰
åœ¨```04-Data-processing/```ç›®å½•ä¸‹ä¸ºé¢„è®­ç»ƒå¤„ç†çš„æµç¨‹ä»£ç 
```txt
ATCGATCGATCG...
GCTAGCTAGCTA...
```
å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨è‡ªå·±çš„ FASTA æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œè¯·å…ˆè¿›è¡Œæ•°æ®é¢„å¤„ç†ã€‚
*è¯¥æ­¥éª¤å°† FASTA åºåˆ—æ¸…æ´—ã€åˆ‡åˆ†å¹¶è½¬æ¢ä¸ºæ¨¡å‹å¯è¯»çš„ TXT æ ¼å¼ã€‚å°†åŸºå› ç»„æ–‡ä»¶ï¼ˆfastaæ–‡ä»¶ï¼‰è¿›è¡Œåºåˆ—æå–ï¼Œè¿‡æ»¤æ‰åºåˆ—é•¿åº¦å°äº10000bpåºåˆ—ï¼Œå°†æ‰€æœ‰ç¢±åŸºç»Ÿä¸€ä¸ºå¤§å†™æ ¼å¼ï¼Œå¹¶å°†â€œNâ€ç¢±åŸºéšæœºæ›¿æ¢ä¸ºATGCä¸­çš„ä¸€ä¸ªï¼Œæœ€åæ ¹æ®BERTæ¨¡å‹çš„æœ€å¤§è¾“å…¥tokenæ•°ï¼Œå°†åºåˆ—æŒ‰ç…§3060bpè¿›è¡Œéé‡å çš„åˆ‡åˆ†ï¼Œä¿å­˜ä¸ºtxtæ–‡ä»¶ï¼Œç”¨äºæ¨¡å‹è®­ç»ƒã€‚*


```bash
cd 04-Data-processing

# æŒ‰é¡ºåºè¿è¡Œå¤„ç†è„šæœ¬ (éœ€æ ¹æ®å®é™…è·¯å¾„ä¿®æ”¹è„šæœ¬å†…çš„ file_paths)
python 01_pretrain_data_one_step.py   # åºåˆ—æå–ä¸è¿‡æ»¤
python 02_pretrain_data_two_step.py   # ç¢±åŸºæ ‡å‡†åŒ–ä¸æ›¿æ¢
python 03_pretrain_data_three_step.py # åˆ‡åˆ†åºåˆ— (Slide Window)
python 04_pretrain_data_txt_merge.py  # åˆå¹¶ä¸ºè®­ç»ƒé›†
```
> **æ•°æ®æ ¼å¼è¯´æ˜**ï¼šé¢„è®­ç»ƒæ•°æ®æœ€ç»ˆä¸º `.txt` æ ¼å¼ï¼Œæ¯è¡Œä¸€æ®µåºåˆ—ï¼ˆå¦‚ 512bp æˆ– 3060bpï¼‰ï¼Œç¢±åŸºå¤§å†™ã€‚


ï¼ˆåœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦æ ¹æ®å®é™…çš„æ–‡ä»¶ç›®å½•å»ä¿®æ”¹ä»£ç ä¸­æ–‡ä»¶çš„è¾“å…¥ä¸è¾“å‡ºè·¯å¾„ï¼‰ï¼Œä¾‹å¦‚ï¼š

```python
file_paths = [
        "~/01_fasta_data/genome_ID1.fasta",
        "~/01_fasta_data/genome_ID2.fasta"]

output_path = "~/01_fasta_data/01_reads_output"
```

### å¾®è°ƒæ•°æ®ï¼ˆCSVï¼‰
æˆ‘ä»¬å°†å¼€æºæ•°æ®é›†è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œä»…ä¿ç•™æ•°æ®é›†ä¸­åºåˆ—æ•°æ®ä¸æ ‡ç­¾å€¼æ•°æ®ï¼Œå…¶ä»–æè¿°ä¿¡æ¯ä¸è¿›è¡Œä¿ç•™ã€‚

```csv
label,sequence
0.1,ATCGATCGATCGATCG...
0.9,GCTAGCTAGCTAGCTA...
```

**ä¸‹æ¸¸ä»»åŠ¡ï¼š**

å¾®è°ƒæ•°æ®ä¸å¯¹åº”åŸºç¡€æ¨¡å‹å®Œæˆçš„å¯¹åº”åŸºå› ç»„ä¸‹æ¸¸åˆ†æä»»åŠ¡ï¼ŒåŸºäº[plant-genomic-benchmark](https://huggingface.co/datasets/InstaDeepAI/plant-genomic-benchmark)å’Œ[PDLLMs](https://huggingface.co/zhangtaolab/datasets)ä¸­çš„6ç§ä¸‹æ¸¸åˆ†æä»»åŠ¡(æ¤ç‰©åŸºå› ç»„)è¿›è¡Œå¾®è°ƒï¼Œå·²å°†æ•°æ®é›†åˆ‡åˆ†ä¸ºè®­ç»ƒé›†ï¼šè¯„ä¼°é›†ï¼šæµ‹è¯•é›† â‰ˆ 8:1:1ï¼Œå…·ä½“åŒ…å«9é¡¹æ•°æ®é›†ï¼š

| ä»»åŠ¡ç±»å‹ | æ•°æ®é›†ç±»å‹               | æ ·æœ¬æ•°                     | æè¿°                                                  |
| :------: | :----------------------: | :------------------------: | :---------------------------------------------------: |
|  å›å½’    | Promoter strength         | 72158/75808               | å¯åŠ¨å­å¼ºåº¦é¢„æµ‹(leaf/protoplast)                       |
|  ä¸‰åˆ†ç±»  | Open chromatin prediction | 148500                    | å¼€æ”¾æŸ“è‰²è´¨é¢„æµ‹                                        |
|  äºŒåˆ†ç±»  | lncRNA prediction        | 50308                     | é•¿éç¼–ç RNAé¢„æµ‹                                       |
|  äºŒåˆ†ç±»  | Sequence conservation     | 70400                     | åºåˆ—ä¿å®ˆæ€§é¢„æµ‹                                        |
|  äºŒåˆ†ç±»  | Core promoter detection   | 83200                     | æ ¸å¿ƒå¯åŠ¨å­æ£€æµ‹                                        |
|  äºŒåˆ†ç±»  | Histone modification     | 102400/102400/99684      | ç»„è›‹ç™½ä¿®é¥°é¢„æµ‹(H3K4me3 / H3K27ac / H3K27me3)       |

---

## ğŸ“¥ æ¨¡å‹ä¸‹è½½
ğŸ‘‰ **HuggingFace Hub**ğŸ¤— : [https://huggingface.co/yang0104/TropicBERT](https://huggingface.co/yang0104/TropicBERT)

åŒ…å«ï¼š
- å…¨éƒ¨ 13 ä¸ªé¢„è®­ç»ƒå˜ä½“ï¼ˆ1 / 5 / 10 ç‰©ç§ï¼‰
- å®šåˆ¶çš„  DNA Tokenizer

---

## ğŸ“ å¼•ç”¨ (Citation)


å¦‚æœæ‚¨ä½¿ç”¨äº† TropicBERT æˆ–æˆ‘ä»¬çš„æµç¨‹ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex

```

---

## ğŸ“§ è”ç³»æˆ‘ä»¬

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ [Issue](https://github.com/yanglin789/TropicBERT-LLMs_One_stop_tutorial/issues) æˆ–è”ç³»ï¼š  
ğŸ“© 1264894293yl@gmail.com

**è®©æ¤ç‰©åŸºå› ç»„å¤§æ¨¡å‹æ™®æƒ â€”â€”ä»çƒ­å¸¦æ°´æœå¼€å§‹ã€‚**

---

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=your-username/GenomePT&type=Date)](https://star-history.com/#your-username/GenomePT&Date)